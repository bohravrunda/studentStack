<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Service Detail - StudentStack</title>
  <link rel="stylesheet" href="/static/styles/details.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
  <style>
    
  </style>

  <!-- Navbar -->
  <nav>
    <div class="logo">
      <img src="/static/images/logo.jpg" class="logo-img" alt="Logo" />
      <span>StudentStack</span>
    </div>
  <!-- ðŸ” Search Bar -->
  <div class="search-container">
    <input type="text" class="search-input" placeholder="Search services..." />
    <button class="search-button"><i class="fas fa-search"></i></button>
    <div class="search-results"></div>
  </div>


    <div class="moving-text">
      <marquee behavior="scroll" direction="left" scrollamount="4">
        Exchange Skills, Expand Possibilities. Trade Knowledge, not just tools.
      </marquee>
    </div>

    <div class="nav-buttons">
      <div class="cart-container">
        <a href="/cart.html" class="cart-icon" title="View Cart">ðŸ›’</a>
        <span class="cart-badge" id="cart-count">0</span>
      </div>
      <div class="menu-icon" style="color: white; font-size: 30px; cursor: pointer;">&#9776;</div>
    </div>
  </nav>


  
<!-- Drawer -->
<div id="right-drawer" class="drawer">
  <ul>
    <li id="avatar-item" style="display:none;">
      <div id="user-avatar" class="user-avatar">RS</div>
    </li>
    <li><i class="fas fa-user"></i><a href="profile.html">Profile</a></li>
    <li><i class="fas fa-eye"></i><a href="view.html">View Services</a></li>
    <li><i class="fas fa-plus-circle"></i><a href="createService.html">Create Service</a></li>
    <li><i class="fas fa-briefcase"></i><a href="createdservices.html">My Services</a></li>
    <li><i class="fas fa-book"></i><a href="bookedServices.html">My Bookings</a></li>
    <li id="logout-item" style="color: red; font-weight: bold; display: none; cursor: pointer;">
      <i class="fas fa-sign-out-alt"></i><span id="logout-link">Logout</span>
    </li>
  </ul>
</div>

<!-- Overlay -->
<div id="overlay" class="overlay"></div>

<div class="service-wrapper">
  <div class="main-content">
    <h1 id="service-name">Loading...</h1>
    <p id="service-note" class="tagline">Loading description...</p>

    <!-- What you'll learn -->
    <div class="what-youll-learn">
      <h3>What you'll learn</h3>
      <ul id="learning-points">
        <li>âœ” Master the basics and advanced concepts</li>
        <li>âœ” Learn at your own pace</li>
        <li>âœ” Improve skill through practice</li>
        <!-- Add more from backend if needed -->
      </ul>
    </div>

    <!-- Provider Info -->
    <div class="provider-info">
      <h3>Provider Details</h3>
      <p><strong>Name:</strong> <span id="provider-name">Loading...</span></p>
      <p><strong>Email:</strong> <span id="provider-email">Loading...</span></p>
      <p><strong>Location:</strong> <span id="provider-location">Loading...</span></p>
    </div>

    <!-- Service Details -->
    <div class="extra-details">
      <h3><strong>Category:</strong> <span id="service-category">Loading...</span></h3>
      <h3><strong>Level:</strong> <span id="service-level">Loading...</span></h3>
      <h3><strong>Language(s):</strong> <span id="service-language">Loading...</span></h3>
      <h3><strong>Available From:</strong> <span id="service-from">--</span> To: <span id="service-to">--</span></h3>
      <h3><strong>Available Days:</strong> <span id="service-days">Loading...</span></h3>
    </div>

    <!-- Proof Material -->
    <div class="proof-container" id="proof-container" style="display: none;"></div>

    
  </div>

  <!-- Sticky Sidebar -->
  <div class="sidebar">
    <img id="service-thumbnail" src="/static/images/placeholder.jpg" alt="Service Image" />
    <p class="price" id="service-price">â‚¹999</p>
    <button class="subscribe-btn" onclick="goToPayment()">Book Your Service</button>
    <button class="add-to-cart-btn" onclick="addToCart()">Add to Cart</button>
  </div>
</div>

  <!-- About Section -->
  <section class="about-section">
    <div class="about-container">
      <h2>About StudentStack</h2>
      <p>
        StudentStack is your one-stop platform to share skills, discover services, and connect with a vibrant student community.
        Whether you want to showcase your talent or explore new opportunities â€” weâ€™ve got you covered.
      </p>
      <div class="social-links">
        <a href="#" target="_blank"><i class="fab fa-instagram"></i></a>
        <a href="#" target="_blank"><i class="fab fa-linkedin"></i></a>
        <a href="#" target="_blank"><i class="fab fa-twitter"></i></a>
      </div>
    </div>
  </section>
<div id="snackbar">Service added to cart!</div>

  <!-- Script -->
  <script>


document.querySelector(".menu-icon").addEventListener("click", function () {
  document.getElementById("right-drawer").classList.add("open");
  document.getElementById("overlay").classList.add("show"); // was 'active'
});

document.getElementById("overlay").addEventListener("click", function () {
  document.getElementById("right-drawer").classList.remove("open");
  document.getElementById("overlay").classList.remove("show"); // was 'active'
});



  window.addEventListener('DOMContentLoaded', async () => {
    try {
      const res = await fetch("http://localhost:5000/me", { credentials: "include" });
      if (res.ok) {
        const user = await res.json();
        const username = user.username || "User";
        localStorage.setItem('username', username);
        localStorage.setItem('userId', user.userId);
        const initials = username.trim().split(" ").map(word => word[0].toUpperCase()).join("");
        document.getElementById('user-avatar').textContent = initials;
        document.getElementById('avatar-item').style.display = 'block';
        document.getElementById('logout-item').style.display = 'block';
      }
    } catch (err) {
      console.error("Error checking login status:", err);
    }

    updateCartCount();
  });







    const urlParams = new URLSearchParams(window.location.search);
    const serviceId = urlParams.get('id');

    async function loadServiceDetails() {
      try {
        const response = await fetch(`http://localhost:5000/get-service?id=${serviceId}`);
        const service = await response.json();

        document.getElementById('service-name').innerText = service.service_name;
        document.getElementById('service-price').innerText = `â‚¹${service.cost?.price || 'N/A'}`;
        document.getElementById('service-note').innerText = service.additional_note || "No description available";
        document.getElementById('service-category').innerText = service.category || 'N/A';
        document.getElementById('service-level').innerText = service.level || 'N/A';
        document.getElementById('service-language').innerText = (service.language || []).join(', ') || 'N/A';
        document.getElementById('service-from').innerText = service.availability?.from || '--';
        document.getElementById('service-to').innerText = service.availability?.to || '--';
        document.getElementById('service-days').innerText = (service.availability?.days || []).join(', ') || 'N/A';
        document.getElementById('provider-name').innerText = service.provider?.name || 'Unknown';
        document.getElementById('provider-email').innerText = service.provider?.email || 'Unknown';
        document.getElementById('provider-location').innerText = service.provider?.location || 'Unknown';

        if (service.portfolio_files && service.portfolio_files.length > 0) {
          const proofUrl = service.portfolio_files[0];
          const proofDiv = document.getElementById('proof-container');
          proofDiv.style.display = 'block';
          proofDiv.innerHTML = `
            <p class="proof-message">âœ… This service was uploaded by a verified provider</p>
            <div id="proof-content"></div>
          `;

          const proofContent = document.getElementById('proof-content');
          const ext = proofUrl.split('.').pop().toLowerCase();

          if (proofUrl.includes("drive.google.com")) {
            proofContent.innerHTML = `<a href="${proofUrl}" target="_blank">ðŸ“Ž View Google Drive Proof</a>`;
          } else if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
            proofContent.innerHTML = `<img src="${proofUrl}" alt="Proof Image" style="max-width:100%; border-radius: 10px; margin-top: 10px;">`;
          } else if (['mp4', 'webm'].includes(ext)) {
            proofContent.innerHTML = `
              <video controls style="max-width:100%; margin-top: 10px; border-radius: 10px;">
                <source src="${proofUrl}" type="video/${ext}">
                Your browser does not support the video tag.
              </video>`;
          } else if (ext === 'pdf') {
            proofContent.innerHTML = `<embed src="${proofUrl}" type="application/pdf" width="100%" height="500px" style="margin-top: 10px;" />`;
          } else {
            proofContent.innerHTML = `<a href="${proofUrl}" target="_blank">ðŸ“„ View Uploaded Proof</a>`;
          }
        }

        const thumbnail = service.thumbnail || '/static/images/placeholder.jpg';
        document.getElementById('service-thumbnail').src = thumbnail;

        updateCartBadge();
      } catch (error) {
        document.querySelector('.service-container').innerHTML =
          '<p style="color: red;">Failed to load service details.</p>';
        console.error("Error:", error);
      }
    }

    async function addToCart() {
      try {
        const response = await fetch(`http://localhost:5000/get-service?id=${serviceId}`);
        const service = await response.json();

        const res = await fetch('http://localhost:5000/add-to-cart', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(service)
        });

        const data = await res.json();
showSnackbar(data.message || "Service added to cart!");
        updateCartBadge();
      } catch (err) {
        console.error("Cart error:", err);
  showSnackbar("Failed to add to cart");
      }
    }

    async function updateCartBadge() {
      try {
        const res = await fetch('http://localhost:5000/cart-count');
        const data = await res.json();
        document.getElementById('cart-count').innerText = data.count || 0;
      } catch (err) {
        console.error("Failed to fetch cart count", err);
        document.getElementById('cart-count').innerText = 0;
      }
    }

    function goToPayment() {
      window.location.href = `/payment.html?id=${serviceId}`;
    }

    document.addEventListener('DOMContentLoaded', loadServiceDetails);

    
  // Animated Search Placeholder
  const phrases = ["Search services...", "Search skills...", "Search students..."];
  let i = 0;
  let charIndex = 0;
  const input = document.querySelector(".search-input");

  function typePlaceholder() {
    if (!input) return;
    if (charIndex <= phrases[i].length) {
      input.setAttribute("placeholder", phrases[i].substring(0, charIndex++));
    } else {
      setTimeout(() => {
        charIndex = 0;
        i = (i + 1) % phrases.length;
        typePlaceholder();
      }, 1500);
      return;
    }
    setTimeout(typePlaceholder, 100);
  }

  typePlaceholder();
    
  // ðŸ” Real-time Search Dropdown
  const searchInput = document.querySelector('.search-input');
  const resultBox = document.querySelector('.search-results');

  searchInput.addEventListener('input', async () => {
    const query = searchInput.value.trim();
    if (!query) {
      resultBox.style.display = 'none';
      return;
    }

    try {
      const res = await fetch(`http://localhost:5000/search-services?q=${encodeURIComponent(query)}`);
      const data = await res.json();

      if (Array.isArray(data) && data.length > 0) {
        resultBox.innerHTML = '';
        data.forEach(service => {
          const div = document.createElement('div');
          div.innerHTML = `
            <strong>${service.service_name}</strong><br>
            <small>${service.category} - ${service.provider?.name || 'Unknown'}</small>
          `;
          div.onclick = () => {
            localStorage.setItem('searchResult', JSON.stringify(service));
            window.location.href = 'view.html';
          };
          resultBox.appendChild(div);
        });
        resultBox.style.display = 'block';
      } else {
        resultBox.style.display = 'none';
      }
    } catch (err) {
      console.error("Search error:", err);
      resultBox.style.display = 'none';
    }
  });

  document.addEventListener('click', (e) => {
    if (!e.target.closest('.search-container')) {
      resultBox.style.display = 'none';
    }
  });

  function showSnackbar(message = "Service added to cart!") {
  const snackbar = document.getElementById("snackbar");
  snackbar.textContent = message;
  snackbar.classList.add("show");
  setTimeout(() => {
    snackbar.classList.remove("show");
  }, 3000); // Snackbar disappears after 3 seconds
}

  </script>
</body>
</html>
